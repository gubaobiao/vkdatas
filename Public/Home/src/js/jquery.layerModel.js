!function(e){"use strict";var t={o:{isIe:!-[1]||document.documentMode>=9,ie6:!-[1]&&!window.XMLHttpRequest,ie9_10:document.documentMode>=9,bgLayer:"layerModel_mask",dataId:"layerModel_main",wrapper:"layerModel_wrapper",warpperContent:"layerModel_content",warpperTitle:"layerModel_title",warpperCloseBtn:"layerModel_closeBtn",warpperOwnContent:"layerModel_ownContent",replaceClose:"replaceClose",dragableClass:"dragable",defaultWidth:300,record:""},generateId:function(){return"_"+(new Date).getTime()},init:function(t,o){var r={center:!0,locked:!0,fixed:!0,drag:!0,zIndex:9999,opacity:"0.5",title:"",staySame:!1,isLoading:!1,width:0,height:0,timer:0,bgColor:"#e5dfda",left:350,top:100,head:!0,isClose:!0,shake:!1,blurClose:!1,close:null,init:null},a=e.extend({},r,o),n=this,i=n.generateId();if("object"==typeof t)t=t instanceof e?t:e(t),t=a.isLoading?n.createRender(t,a,i).hide():a.staySame?n.createRender(t,a,i).hide():n.createContainer(t,a,i).hide();else{if("string"!=typeof t&&"number"!=typeof t)return void alert("Layer Error : Unsupport data type :"+typeof t);t=e("<div id='"+n.o.dataId+i+"'></div>").html(t).appendTo(document.body).hide()}if(a.locked&&!n.hasBgLayer()){var s=e("<div class='"+n.o.bgLayer+"' id='"+n.o.bgLayer+"'></div>").appendTo(document.body).css({background:a.bgColor,opacity:a.opacity});n.o.ie6&&s.html('<iframe src="about:blank" style="width:100%;height:100%;position:absolute;top:0;left:0;z-index:-1;scrolling=no;filter:alpha(opacity='+100*a.opacity+')"></iframe>')}return t.css({position:a.fixed?n.o.ie6?"absolute":"fixed":"absolute","z-index":a.zIndex,left:a.left,top:a.top}).show(),a.center&&(n.fixLayer(t),e(window).bind("resize scroll",function(){n.fixLayer(t)})),a.drag&&n.dragLayer(t,a),a.shake&&n.shakeLayer(t),a.init&&"function"==typeof a.init&&a.init(),a.timer>0&&setTimeout(function(){e("#"+n.o.replaceClose+i).trigger("click")},parseInt(a.timer,10)||3e3),a.blurClose&&e("#"+n.o.bgLayer).click(function(t){n.close(e("#"+n.o.wrapper+i),a,i),e("body").prepend(n.o.record),t.stopPropagation()}),t},createContainer:function(t,o,r){var a=this,n=void 0==t.context,i=new Array;i.push("<div class='"+a.o.wrapper+"' id='"+a.o.wrapper+r+"'>"),i.push("<div class='"+a.o.warpperContent+"' id='"+a.o.warpperContent+r+"'>"),i.push("<a class='"+a.o.replaceClose+"' id='"+a.o.replaceClose+r+"'></a>"),o.head&&(i.push("<h4 class='"+a.o.warpperTitle+" "+a.o.dragableClass+"' id='"+a.o.warpperTitle+r+"'>"),o.isClose&&i.push("<a href='javascript:void(0);' title='关闭' class='"+a.o.warpperCloseBtn+"' id='"+a.o.warpperCloseBtn+r+"'>×</a>"),i.push(o.title+"</h4>")),i.push("<div id='"+a.o.warpperOwnContent+r+"' class='"+a.o.warpperOwnContent+"'></div></div></div>"),a.container=e(i.join("")),a.container.appendTo(document.body),t.clone(!0).appendTo("#"+a.o.warpperOwnContent+r).show().attr("id",t.attr("id")||a.o.dataId+r);var s=e("#"+t.attr("id")).width()||e("#"+a.o.dataId+r).width()||a.o.defaultWidth,d=s;if(o.height>0){if(o.width>0)if(d=o.width,o.width<=s)e("#"+a.o.warpperOwnContent+r).css({width:o.width,"overflow-x":"auto"});else{var p=(o.width-s)/2+8;e("#"+a.o.warpperOwnContent+r).css({padding:"4px "+p+"px"})}a.container.width(d+32),e("#"+a.o.warpperContent+r).width(d+30),e("#"+a.o.warpperOwnContent+r).css({height:o.height,"overflow-y":"auto"})}else o.width>0&&(d=o.width,o.width<=s&&e("#"+a.o.warpperOwnContent+r).css({width:o.width,"overflow-x":"auto"})),a.container.width(d+22),e("#"+a.o.warpperContent+r).width(d+20);return e("#"+a.o.warpperCloseBtn+r).click(function(t){e("#"+a.o.replaceClose+r).trigger("click"),e("body").prepend(a.o.record)}),e("#"+a.o.replaceClose+r).click(function(t){a.close(e("#"+a.o.wrapper+r),o,r),t.stopPropagation()}),n||a.elemBack(t,r),a.o.record=t.detach(),a.container},createRender:function(t,o,r){var a=this,n="border:none;";n+=o.isLoading?"box-shadow:none;":"background:#fff;";var i=void 0==t.context;return a.container=e("<div class='"+a.o.wrapper+"' style=' "+n+" ' id='"+a.o.wrapper+r+"'><a class='"+a.o.replaceClose+"' id='"+a.o.replaceClose+r+"'></a></div>"),a.container.appendTo(document.body),t.clone(!0).appendTo(a.container).show().attr("id",t.attr("id")||a.o.dataId+r),e("#"+a.o.replaceClose+r).click(function(t){a.close(e("#"+a.o.wrapper+r),o,r),t.stopPropagation()}),i||a.elemBack(t,r),t.detach(),a.container},elemBack:function(e,t){var o=this,r=e.css("display"),a=e[0],n=a.previousSibling,i=a.nextSibling,s=a.parentNode;o["elemBack_"+t]=function(){n&&n.parentNode?n.parentNode.insertBefore(a,n.nextSibling):i&&i.parentNode?i.parentNode.insertBefore(a,i):s&&s.appendChild(a),e.css({display:r})}},isLastLayer:function(){var t=this;return e("."+t.o.wrapper).length<=0},hasBgLayer:function(){var t=this;return e("."+t.o.bgLayer).length>0},close:function(t,o,r){var a=this,n=!0;o.close&&(n=o.close()),(void 0==n||n)&&(t.remove(),a.isLastLayer()&&e("#"+a.o.bgLayer).remove()),a["elemBack_"+r]&&a["elemBack_"+r]()},closeLayer:function(t){var o=this,r=e(t).parents("div."+o.o.wrapper);e("."+o.o.replaceClose,r).trigger("click")},fixLayer:function(t){var o=this,r=(e(window).height()-t.innerHeight())/2+(o.o.ie6?e(document).scrollTop():t.scrollTop()),a=(e(window).width()-t.width())/2+(o.o.ie6?e(document).scrollLeft():t.scrollLeft());return t.css({left:a,top:r>=0?r:50})},dragLayer:function(t,o){var r=this,a=!1,n=0,i=0,s=t.find("."+r.o.dragableClass).css({cursor:"move"}),d=s[0];s.mousedown(function(o){var s=r.o.isIe&&1==o.button||!r.o.isIe&&0==o.button||r.o.ie9_10&&0==o.button;return!!s&&(r.o.isIe?d.setCapture():window.captureEvents(Event.MOUSEMOVE),a=!0,n=o.pageX-parseInt(t.css("left")),i=o.pageY-parseInt(t.css("top")),e(document).mousemove(function(e){if(a){var o=e.pageX-n,r=e.pageY-i;t.css({top:r,left:o})}}).mouseup(function(){a=!1,n=0,i=0,r.o.isIe?d.releaseCapture():window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP)}),void 0)})},shakeLayer:function(t){for(var o=(e(window).width()-t.width())/2,r=4,a=1;a<=r;a++)t.animate({left:o-(10*r-10*a)},50),t.animate({left:o+2*(10*r-10*a)},50)}};e.fn.layerModel=function(e){return this.each(function(o,r){t.init(r,e)})},e.fn.close=function(){t.closeLayer(this)},e.fn.fix=function(){var o=e(this).parents("."+t.o.wrapper);return t.fixLayer(e(o[0]))}}(jQuery);